pipeline {
    agent { label 'ubuntu-agent-102' }

    environment {
        PYTHON_VERSION = "3.12"
    }

    stages {
        stage('Set up Python') {
            steps {
                sh "python${PYTHON_VERSION} --version"
                sh "python${PYTHON_VERSION} -m pip --version"
            }
        }

        stage('Activate virtual environment') {
            steps {
                sh "bash -c 'source /home/tux/ragadmin_llm/bin/activate'"
            }
        }

        stage('Analyse the code with pylint') {
            steps {
                sh "pylint \$(git ls-files '*.py')"
            }
        }

        stage('Run tests') {
            steps {
                sh "pytest"
            }
        }
    }

    post {
        always {
            echo 'Pipeline termin√©e'
        }
    }
}